module Day03 exposing (input, part1, part2)

import Set exposing (Set)


part1 : List String -> Int
part1 stringList =
    countTrees (parseData stringList) ( 3, 1 )


part2 : List String -> Int
part2 stringList =
    let
        fn =
            stringList
                |> parseData
                |> countTrees
    in
    [ ( 1, 1 )
    , ( 3, 1 )
    , ( 5, 1 )
    , ( 7, 1 )
    , ( 1, 2 )
    ]
        |> List.map fn
        |> List.foldl (*) 1


type alias Area =
    { trees : Set ( Int, Int )
    , width : Int
    , height : Int
    }


parseData : List String -> Area
parseData stringList =
    let
        trees : Set ( Int, Int )
        trees =
            stringList
                |> List.indexedMap
                    (\y string ->
                        string
                            |> String.toList
                            |> List.indexedMap
                                (\x char ->
                                    ( ( x, y ), char )
                                )
                            |> List.filter (Tuple.second >> (==) '#')
                            |> List.map Tuple.first
                    )
                |> List.concat
                |> Set.fromList

        width =
            stringList
                |> List.head
                |> Maybe.map String.length
                |> Maybe.withDefault 0

        height =
            stringList
                |> List.length
    in
    { trees = trees, width = width, height = height }


countTrees : Area -> ( Int, Int ) -> Int
countTrees { trees, width, height } ( dx, dy ) =
    let
        helper : ( Int, Int ) -> Int
        helper ( x, y ) =
            if y > height then
                0

            else if Set.member ( x, y ) trees then
                1 + helper ( modBy width (x + dx), y + dy )

            else
                helper ( modBy width (x + dx), y + dy )
    in
    helper ( 0, 0 )


input : List String
input =
    [ "...............#...#..#...#...."
    , "...#....##.....##...######..#.."
    , "....#.....#.##..#...#..#......."
    , "...#..........#.#....#......#.."
    , "....#.#...#.#.......#......##.#"
    , "....#.#..........#.....#.##...."
    , "##...#.#.##......#......#.#.#.."
    , "#.#.#........#....#..#.#......."
    , "..#...##..#..#.......#....###.."
    , ".#.#..........#...#........#..#"
    , ".#..#......#....#.#...#...#.#.#"
    , "..#.........#..##.....#.#.##.#."
    , ".#......#...#....#.....#......#"
    , "........#..##..##.........#..#."
    , ".....#....###..#....##........#"
    , ".###...#..##..#.##......##...##"
    , ".#...#...#..#.#..#...##.....#.."
    , ".......#....#....#.#...#......."
    , ".##.......#.##...#.#...#..#...."
    , "#.#...#......#....#.......#...."
    , "..###...............####...#.#."
    , ".##.#....#......#..#...#.#..#.#"
    , ".............#.#.#......##....."
    , "#....#.#.#........#....##...#.."
    , "...##....##...##..#...#........"
    , "..##......#...#......#...###..."
    , "...#...##......##.#.#..#......."
    , "#......#..#...#.#..#......#..##"
    , ".#..#..#........##....##......."
    , ".#...........###.###.##...#...."
    , "............#.#...........#.#.."
    , "#...#........#...#...#..#.#.#.#"
    , "...#.......#.#.#..#.#.........."
    , "......#..#..#....##..##..##...."
    , "........##...#......#..#.#....."
    , "..#.#.......#......#..........."
    , "#.#.....#......##..........#.#."
    , "#.....###.#...#...#..#....#...#"
    , ".##.#...#............##.....#.."
    , "###....#.#.....#.......##......"
    , "##.......##.....#..#...#..##.##"
    , "....#.##............###...#..##"
    , ".###..#...##.#..#..##..#......."
    , ".##.##..####.....#.........#..."
    , "....####..#...#....#.#...#....."
    , "..##....#..#......#...........#"
    , "..........#......#..##.......#."
    , ".................#.#.#........#"
    , "#.......##.#...##.......##.##.."
    , ".#................#.#.....##..#"
    , "......#..#............##.#....."
    , "...##............#.....#.....#."
    , "##.###.#.......#....#.........#"
    , "......#.....#.#.#.#......#....."
    , "......#.##......#......##......"
    , "..#....#...#..#.....#..#....#.#"
    , ".#.##.##.....#.......#.......#."
    , "...#..#.#......##....##..#....."
    , ".#.....#......##...#..#.#....#."
    , "..#......#....#..#..###.#.#...."
    , ".....#........#.#...#..#.#....."
    , "....#.#.......#...##.....####.."
    , "#..#..##...#...........#...#..#"
    , ".#..#...#.....#.....#.#.....#.#"
    , "..##..###.....#...#.#.#.......#"
    , "#..##.##......###..#......###.."
    , "#..#...#.......#....#.#...#.#.#"
    , "...........###..#...#..##....#."
    , ".....#...........###.......#..."
    , "##......#.......#......##.#..#."
    , "#.................#........#..."
    , "#.#.............#......#...#..#"
    , "......#.#....#....#....#....#.#"
    , "..#...#....#..#....#....#..#..."
    , "#....#......#..#...#..#....#.#."
    , "..#.....#..#...#...#.......#..."
    , ".#........###..##.#..#........."
    , ".....##.#.....#..###..#........"
    , "...#...#.###....######......#.."
    , ".###.#..#.....#.....#..#...#..."
    , "##..#.#......#.........#...#..#"
    , "###...##..###.......#..##.#.#.#"
    , ".#...................#..#...##."
    , ".#...#...###...#.......#......#"
    , "....#.....##....#...##.#...#.##"
    , "..#....#......#...#..###......."
    , ".........#..........##........#"
    , "...#.........##..#....#..###..."
    , "......#.##....#.#........#.#.##"
    , "....#..#...#.............#....#"
    , "#..#.....#.#.....#....#........"
    , "....#..#...####.#.###..#......."
    , ".....#....#....#..#..#.#.....#."
    , "#..##....#.....#.#............."
    , ".##...#..#.......#...##.###...."
    , "##......#...##....#......##...."
    , "#......#.#......#.#..#......#.."
    , ".#...#......#............###..#"
    , ".#..#.#.....#.#.....#..#....#.."
    , ".#............#...#..#..#...##."
    , "...#...#....#.#.#....#....#...."
    , "........#......###.#....##.##.#"
    , "......#.#..................##.."
    , "..#..#........#..##..........##"
    , ".#...#.#....#####.#.#..#......."
    , ".....#..#.#..#.....#.#........#"
    , "#.#..#..#.#..........#..#..#..."
    , ".##........#.#.......#........#"
    , ".....#....#..##...#......##...."
    , "....#.##.##...##.#.........#.#."
    , "...#...#..#.#.......#.......#.."
    , ".................##..#........."
    , "..##.##....#...#.##.......#..#."
    , "....#...........#.....###....##"
    , ".#..................#.........."
    , "....#.##....#......##.#..#.##.#"
    , "#......#..#.#....##...####...#."
    , "#.....#.#.##...........#.##...#"
    , ".......#...##..#.........##...."
    , ".#...#..........##......#..#.#."
    , "#...#.#......#.....#........#.."
    , "........#.....#.......##......#"
    , ".#..#...........#...#..#..#...."
    , "......#.##......##.#......#..##"
    , "......#....#..#................"
    , "##.#.......#......#..#....##.##"
    , "..#...###..#.......#...#.#....#"
    , ".....#...#.........#.....#..#.#"
    , "..#.....#.........#..#...#.#..."
    , ".#.........##..#.#...#.....##.."
    , "..........#.#.#...#....#....#.."
    , "....#.###.#..#..#..#.#........#"
    , "..#...##...##.#.#.....#.#..##.."
    , ".#..#......#.####..#.......#..#"
    , "##.......#.....#.#.#..#...##..#"
    , ".##......##...##.........#..#.."
    , "..#.##..#......#......#..#..#.."
    , "..#..#.##..#........#....#.#..."
    , "##.####...##.#..##.........#..#"
    , ".#.......#.#..#.....#.##......."
    , "........#.........#...........#"
    , "..#...#.####.....##.##.#....#.#"
    , ".....#..##.#..###.##.#.#...#..."
    , "#..##..##....#...#....#...#...."
    , ".###.#....#..#.......#......###"
    , ".#....##.....#.#........#...#.#"
    , "#.#.#..#..#...#....#..#.....#.."
    , "....##...#.##..#............#.."
    , "##......###...#...#...#....#..."
    , "#.#...#.#..#..##.##..##..#....#"
    , ".#...#.#....#..##.#..##..#....."
    , ".............#..#..#.#.....#..."
    , "#........#..........#....###..."
    , "..#..#......#...#........#....."
    , ".#..#.............#.........#.."
    , "#.....#....##..#..#.#.#..#....."
    , "...#......#.........#.#....##.#"
    , "..#.......##....###..#........."
    , ".#.......#......#.............."
    , ".#...##.....##...###.#....#.#.."
    , "......#....#.........#.......#."
    , "##.......#..##....###.#.....##."
    , ".....#......####.....#......#.."
    , "....#....#..###....#.....##...#"
    , "...#...#.#........#.....#..#.##"
    , "#..#....#.#...###...##.....##.."
    , "#.....##...#.#............#...."
    , "##....#.......#.#.#....#.#.###."
    , "#........#...#...####.#....#.#."
    , ".##.#......#........#..#.....#."
    , "...##.#.......#...#.#.##..#...#"
    , "......#.........##..#....#....."
    , ".#......#...........#......#..."
    , "......#.#.#.#..#.#....#....#..#"
    , "##.................##...#.#...."
    , "........#.........#..#..#...###"
    , ".#........#........#....#..#..."
    , "....###.##.##......#.#...#....#"
    , "#......#.#..............#......"
    , ".......#..#....#..##.........#."
    , "#............#....#............"
    , "#...#.#.........##..###...##..."
    , ".#....#.#.#.....#..#..##......."
    , ".............##.#.#.......#..#."
    , "#...#..##.#..###.....##..#....."
    , "...#.#.....#...#......##.#..#.."
    , "#..........#.##.#...#...#.#...#"
    , "...#.#...#.........#.#..#.#..#."
    , "#....#.................#......."
    , "..#..#.#.#..#.#..##...#.#......"
    , "..#....#.#.#...#.....#...#....."
    , "#...#.###......#.......#..#..#."
    , "#.#.##.##..............#.#.#..#"
    , "#..........#.#.........#.###..."
    , "...........#.......#.#..#......"
    , "....#.#..#....#....#....##....."
    , "#..#...##########.........#.#.."
    , "..#.............##........#.#.."
    , "#.#.##......#...#.#....##..##.."
    , "..##..#.#.#....#......#.#..#.#."
    , ".#.#...#................#......"
    , "#...#...#.....##.#...#.......#."
    , ".....##.......#...#......#.##.."
    , "....#.##..........#.#.##....##."
    , "...........##........#.#.#.#..."
    , "..#...........###.#....#..#...."
    , "..#.#...#...#.#........#.....#."
    , ".##......##.....#........#....."
    , "....#.......#....#...#.##...#.."
    , ".#.....##.....#...##..........."
    , "#....#.##.##...#...###.#####..."
    , "..#.#......#.#.......#....#..#."
    , "..........#...#...........#...."
    , ".........#..#...#...#......#.##"
    , ".#...#.#...#.###.##..#........#"
    , "#....#.....#.......##....#....."
    , "#.....#..#.....#...##.......#.."
    , "#.#.#.#.............#.....#...#"
    , "...#.....#.....#..............."
    , "..##.###.#.#........#.........#"
    , "...##..#.##..#....#.#...#.#...."
    , "...##...#...##.#.........#.#..#"
    , ".###......#....#.........#.#..."
    , "###.#.#...#.......#...#.....#.#"
    , "...#.#.......#.....####........"
    , "......#..#.....###.#....#..#..."
    , "..####...#...#..#......#...#..."
    , "#..............##....#......##."
    , "..##..###...##..#.#.........#.."
    , "#..#.#...#.......#.........##.."
    , "..##....#......#...#..##......."
    , "..#.#..#..###.....#.....#...###"
    , ".#..#.##.....##.#.#.#........#."
    , "..#.#.........#................"
    , "..#...........#.#...##.#...#..#"
    , ".....#........#..#.....#....#.."
    , "#.#....#...........##.....#..##"
    , "##.......#.....#.....#.#......#"
    , ".##............####.#........##"
    , "....##.#.....#......#....#...#."
    , ".#.#...##.#..##..#..........#.."
    , "..........................#...."
    , "##..##..#..#.#....#.....#......"
    , "...#.#........#.#.##.#.....#..#"
    , "#..#....#...#..#...#........#.#"
    , "#.......#####...#..#..#.#......"
    , "#.##....#......#......#..###..."
    , "..#.......#...........#.....##."
    , "#...#....#..#......##...#......"
    , "...##.#..##........#..###......"
    , "##.#...........#.............##"
    , "#.....#..#.....#.....#........."
    , ".#..........#..#......###......"
    , "...#...#..##.......#...#...#.#."
    , "..####......#.....#..#.#......#"
    , "....#..#.....#.#..............."
    , ".#.......#....#.....#..##....#."
    , ".....#.........#..........##..."
    , "#...........#..#.....#........#"
    , "............#..##...#...#.#...."
    , "##.............####...#.....#.."
    , ".....#......#....##.#.....##..."
    , "...........#.....#.#..#.#......"
    , ".#.#......#....#.............##"
    , "##...#.#.......##........#....."
    , "#..#.....#.#.......####...#..#."
    , "....#.#...#....#.###..#..#.#..."
    , ".....#.#..#......#.##.#####.#.."
    , ".....#....##..........#......#."
    , "#.......#........##.......##..."
    , "#...#..#..##.#....#...#...#...."
    , "...#..##..#...#..........#....."
    , "#..#....###.....#......##......"
    , "...###......#.....#....#......."
    , "#.#...#.#..###.####.......#.#.#"
    , "...#......#.#..##..#.....#....."
    , "#.#............#.....##.#......"
    , "#..#......##...##..#...#.#..###"
    , "#.....#...#..#..#....#..###...."
    , "####..###....#..##....#..#....."
    , "..##.#.....#.......##....#.#.#."
    , "##..#.#.......#.#...##.#..#.#.."
    , "..#.#.#.##.#.#.#...........#..."
    , "...#.##.....#....#..#.#..#....."
    , "...#..#.........#..........#..#"
    , "#...#..#.....#.#.#............."
    , "##.#....##.##...#...#..#..#..#."
    , "....####..##..##.#..#...##....."
    , "##.....##.#.#...#.#.......###.."
    , "#..#.#....#......#.......##...#"
    , "#.#...............#..#..#......"
    , ".....##...##..#........#......#"
    , ".#..#............##......#....#"
    , "......#.#..#..##.#......#.....#"
    , "..#.#.............#...#......##"
    , "....#.#..#..#...##...#..##....."
    , "#.#.............#...#.#..#....#"
    , "#..#..#.##....#....#...#......."
    , "....#..#..........#.....##...#."
    , "..#####.......#...#..........#."
    , "....#......##.......#..##.#.#.#"
    , "#...#.#.....#....#....##......."
    , "..##.#.#..#.#...#.....##.....#."
    , "#.#..#....#............#..#.#.."
    , "...#.##..##..#.#...###......#.#"
    , "......##.......#....#......###."
    , "....#..##.......#..#.#....#..#."
    , "#............#..........##..#.#"
    , "..#.....#..#.#..##..#....##.#.."
    , ".....#.....#....##.#.#......#.#"
    , "...####.......###..#...#.#....#"
    , ".#.##.....##.....##..#..#......"
    , "...#..###..##.................."
    , "##..##.....#.#..#..#.#........#"
    , ".#.#........##.........#....#.."
    , "........#......###....#...#...."
    , "......#...........#...........#"
    , ".#...###...#.........#.#...#..#"
    , ".....#..........#......##....#."
    , ".#.#...#........##.......#.#..."
    , ".....##.....##....#...#...#..#."
    , "..#.....................##...##"
    , "#..#.#......##...##..#......#.."
    ]
